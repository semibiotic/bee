                     Поддержка тарифных планов

          DISCLAIMER

  Текущая поддержка тарифных планов, реализована на уровне хака в демоне
билинга и не поддерживается другими модулями (например веб-интерфейсом),
может измениться в будующих версиях.

          ОБЩАЯ ИНФОРМАЦИЯ

  Аккаунт дополняется новым полем - номером тарифного плана. Тарифный план
позволяет (пере-)определить:
  >> цену для ресурса inet в т.ч.
     >> разные цены для разных периодов суток и направления трафика
        (входящий/исходящий)
  >> допустимый кредит по счету

  По умочанию (для создаваемых счетов и счетов созданных до реализации
тарифных планов) используется тариф с номером 0.

  Номер тарифного плана выводится командой acc (не выводится для тарифного
плана 0).
  Тарифный план меняется командой _tariff (см. COMMANDS).

          ОПРЕДЕЛЕНИЕ ЦЕН РЕСУРСА inet

  Цена inet определяется таблицей inet_tariffs в файле "core/res.c" 
Таблица выглядит так:

inet_tariff_t  inet_tariffs[] =
{
   { 0,  0,  0,  3.0, 3.0},  // default price
   { 0,  2,  9,  1.8, 1.8},  // night dead time
   { 0, 15, 19,  3.5, 3.5},  // day rush hour
   {-1, -1, -1, -1}          // (terminator)
};

значения в строке означают:

   { 0,  2,  9,  1.8, 1.8},  // night dead time
      \   \   \    \    \        \___комментарий_________
       \   \   \    \    \__исходящий_трафик_(руб/Mбайт)_
        \   \   \    \______входящий_трафик_(руб/Mбайт)__
         \   \   \__конец_времени_действия_(час,_не_включая)
          \   \__начало_времени_дейтсвия_(час,_включая)__
           \__номер_тарифного_плана__ 

  Таким образом, приведенная выше дефолтная таблица определяет
следующие значения:
   
  Строки с временем начала и конца равным нулю определяют цены по умолчанию
для соответствующего тарифного плана.
  Если для тарифного плана такая строчка не будет найдена, то, в качестве цен
по умолчанию будут использованы значения из ПЕРВОЙ СТРОКИ.

  Таким образом таблица приведенная выше определяет:

  >> цену 3 руб/Мбайт (для обоих направлений) по умолчанию
  >> тарифный план 0
    >> цену 1.80 руб/Mбайт (для обоих направлений) для времени с 2 до 9 часов
    >> цену 3.50 руб/Мбайт (-//-) для времени с 15 до 19 часов
    >> цену 3 руб/Mбайт (-//-) в остальное время

  Редактирование таблицы осущетсвляется
  >> заменой значений в строках
     >> не трогать запятые и знаки "{", "}" !),
     >> не трогать значений в строке терминатора !
  >> добавлением новых строк
     >> вставлять перед строкой терминатора !
     >> важно точно написать все запятые и скобки (лучше всего сделать копию
        существующей строки и заменить значения)
  >> удалением ненужных строк
     >> нельзя удалять первую строку (перед терминатором должна быть хотя-бы
        одна строка данных)
     >> нельзя удалять строку терминатора

  После редактирования пересоберите демон ("make all install" в каталоге core),
если файл был отредактирован неаккуратно, программа не соберется, в этом случае
попробуйте отредактировать его снова (в тяжелых случаях, таблицу или файл можно
восстановить с сайта).
  После успешной сборки нужно перезапустить (остановить и запустить вновь
собранный) демон bee.

          ОПРЕДЕЛЕНИЕ ДОПУСТИМОГО КРЕДИТА

  Допустимый кредит для тарифного плана определяется таблицей limits в
файле core/core.c.  Таблица выглядит так:

limit_t    limits[]=
{
  { 0,  0.00 }, // default limit
  {-1, -1    }  // (terminator)
};

значения в строке означают:
  
  { 0,  0.00 }, // default limit
     \    \           \___комментарий_________
      \    \______________минимально-допустимое_значение_баланса
       \_________________номер_тарифного_плана__ 

  Если для тарифного плана лимита не определено, то будет использовано
значение из ПЕРВОЙ СТРОКИ.

  Таким образом таблица приведенная выше определяет:

  >> минимум 0.00 руб - по умолчанию
  >> минимум 0.00 руб - для тарифного плана 0 

  Заметки по редактированию и сборке программы с новыми значениями смотрите
предыдущий раздел.
