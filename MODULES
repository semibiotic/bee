$RuOBSD: MODULES,v 1.4 2005/04/05 08:29:00 shadow Exp $
Last update: 1.08.2005

            МОДУЛИ                  

path - сore  
bin  - /usr/local/bin/bee

     Ядро билинга. 

     Может быть запущен в двух режимах

   * Режим демона (ключ -d) Ядро запускается как tcp-сервер
      (по умолчанию на порте 49160), в ожидании соединений.
      При нормальной работе должна быть запущена одна
      инстанция ядра в режиме демона (чтобы принимать
      соединиения от счетчиков). 

   * Консольный режим (ключ -c) - однопользовательская консоль
      билинга на stdin/stdout. Перенаправленим ввода/вывода можно
      получить подобие скриптов.

   Если не указать ни одного из ключей, программа не войдет в
   основной цикл (т.е. выполнение команд), но выполнит все
   предварительные операции.

     Одновременно может быть запущено несколько инстанций программы.
   Для нормальной работы, одна инстанция должна работать в режиме
   демона.

        Usage:  bee [options]

 A    - TCP-порт (default - 49160). Имеет смысл только для режима демона
 u    - Обновить разрешения ПЕРЕД стартом основного цикла
 d    - запуститься в режиме демона 
 c    - запуститься в консольном режиме
 h, ? - помощь (не реализовано)

path - modules/traff
bin  - /usr/local/bin/beetraff

     Счетчик трафика. Клиент билинга.

     Не считает трафик самостоятельно, а парсит дамп статистики
   с коллекторов cnupm (cnupmstat -BEn) и ipstatd (dumpstat stat)
   требует запуска демона коллектора в /etc/rc.local (rc(8))
      cnupm -i pflog0 -e
          или
      ipstatd

     Коллекторы не вхотя в пакет билинга, и устанавливаются отдельно.
     
     По умолчанию программа работает с коллектором cnupm, для
   работы с ipstatd нужно указать ключ -с.

     Программа соединяется с билингом и передает ему подсчеты
   (командами res). Когда статистика заканчивается, на билинг
   отдается команда update (обновление правил) если указан
   ключ -u.
 
     Снятие статистики с коллектора cnupm сложнее чем с ipstatd,
   выполняется скриптом bee-cnupmdump.sh (см. скрипт)

     Usage: 
            bee-cnupmdump.sh | beetraff -c [<switches>]
            bee-cnupmdump.sh > tempfile && beetraff -f tempfile [switches]
            dumpstat stat | beetraff -c [<switches>]
            dumpstat stat > tempfile && beetraff -c -f tempfile [switches]

 r - имя ресурса            (default - inet)
 a - хост билинга           (default - 127.0.0.1)
 A - порт билинга           (default прописан в ipc.h)
 u - дать команду update    (default - no)
 n - включить хост в список локальных
 N - исключить хост из списка локальных
 f - имя файла статистики   (default - stdin)
 с - режим ipstatd          (default - cnupm)

path   - modules/scripts
script - /usr/local/bin/beetraff.sh

     Скрипт-оболочка счетчика трафика.
   Cюда же рекомендуется добавить вызов счетчиков других ресурсов,
   базирующихся на трафике (причем последний с ключом -u).

   Прописывается в crontab.

path   - modules/scripts
script - /usr/local/bin/beetraff-cnupm.sh

     Шаблон /usr/local/bin/beetraff.sh при использовании cnupm.

path   - modules/scripts
script - /usr/local/bin/beetraff-ipstatd.sh

     Шаблон /usr/local/bin/beetraff.sh при использовании ipstatd.

script - /usr/local/bin/beepfrules.sh

     Скрипт-оболочка генератора правил beeipf (стал использоваться для pf)
     Прописан в строку генератора правил для ресурса inet.

script - /usr/local/bin/beeapply.sh

     Cкрипт, для активации правил для всех ресурсов.

script - /usr/local/sbin/intractl.sh

     Скрипт управления ресурсом intra (включение и выключение портов
   на свитче). Намеренно вынесен из общей процедуры обновления
   ресурсов вызвывается командой intractl билинга и/или из cron(8).
     Использует файл конфигурации /etc/bee/intra.conf (SNMP-описание
   устройств).
     Для SNMP использует пакет ucd-snmp-4.2.

script - /usr/local/bin/newlogin.sh

     (скрипт для макрокоманды new_name)

     Запускает скрипт autoreg.sh на удаленном хосте.

script - /usr/local/sbin/autoreg.sh

     (скрипт для макрокоманды new_name)

     Скрипт автоматической регистрации пользователя (имя пользователя
    передается в командной строке)
       >> добавляет группу
       >> генерирует случайный пароль 
       >> регистрирует учетную запись
       >> прописывает пользователя в chrootftp
       >> настраивает дисковые квоты (до 3.1 может вызывать крах системы)
       >> Возвращает пароль или сообшение об ошибке

path - rulers/traff
bin  - /usr/local/bin/beeipf

     Генератор правил ipf/pf.

     Строка для запуска (прямо или через скрипт) определяется в описателе
   ресурса. 

      Usage: beeipf [<switches>]

s - filter source file (default - /etc/ipf.rules)
t - filter target file (default - /var/bee/ipf.rules.effecive)
d - destination host   (default - "any")
i - target interface   (default - none)
r - resource name      (default - inet)
f - hostlist filename  (default - /var/bee/allowed.inet)
P - destination suffix (default - "")
p - source suffix      (default - "")
m - filter file mark   (default - "#<beerules>")
S - rule suffix        (default - "")
R - swap in & out      (default - no swap)
l - word before "on"   (default - "")
o - only one rule      (default - two rules)

path - utils/acc_on
bin  - /usr/local/bin/acc_on

     Включить аккаунт (аргумент). Для вебформы.
     
path - utils/acc_off
bin  - /usr/local/bin/acc_off

     Выключить аккаунт (аргумент). Для вебформы.

path - utils/ip2acc
bin  - /usr/local/bin/ip2acc

     Преобразовать ip в номер аккаунта.

path - utils/getacc
bin  - /usr/local/bin/getacc

     Программа для упрощенной PHP-веб формы (программа выводит
   отформатированный сегмент веб-страницы) просмотра пользователем
   состояния своего счета. Параметром ей передается ip адрес клиента,
   Резюме состояния счета выводится на stdout.

path - utils/getacc2
bin  - /usr/local/bin/getacc2

     Программа для сложной PHP-веб формы (выводятся несколько чисел - 
   параметры счета, под парсинг скриптом, генерация HTML-кода ложится на
   PHP-скрипт) просмотра пользователем состояния своего счета. Параметром
   ей передается ip адрес клиента. Резюме состояния счета выводится на
   stdout.

path - utils/beerep
bin  - /usr/local/bin/beerep

     Программа генерации HTML-отчета. Программа самостоятельно обращается
   к таблице лога транзакций и выбирает подходящие записи.

   Описание и ключи командной строки см. ulils/beerep/BEEREP

path - utils/payman
bin  - /usr/local/bin/payman

     АРМ кассира - программа для просмотра состояния и зачисления денег на
   счета.

   Описание см. ulils/payman/README

path - utils/clubctl
bin  - /usr/local/bin/clubctl

     Q&D решение урезанной консоли билинга (для управления доступом в инет
   с нескольких рабочих станций). Устанавливается в качестве пользовательского
   шелла.

path - utils/logidx
bin  - /usr/local/bin/logidx

     Утилита (пере-) создания посуточного индекса журнала транзакций
   (опритмизация по скорости для beerep). Рекомендуется запускать ежедневно
   после часа ночи.


path - utils/proxy

     Отладочная исследовательская утилита (журналирующий TCP-прокси).

