/* $oganer: recode.c,v 1.1 2005/05/09 14:47:03 shadow Exp $	 */

/*
 * Copyright (c) 2002, 2003, 2004 Maxim Tsyplakov <tm@oganer.net>
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

#include <sys/types.h>
#include <stdio.h>

#include "misc.h"

/* win1251-koi8 recoding table */
static u_char win2koi8[] = {
	(u_char)0x00, (u_char)0x01, (u_char)0x02, (u_char)0x03, 
	(u_char)0x04, (u_char)0x05, (u_char)0x06, (u_char)0x07,
	(u_char)0x08, (u_char)0x09, (u_char)0x0A, (u_char)0x0B,
	(u_char)0x0C, (u_char)0x0D, (u_char)0x0E, (u_char)0x0F,
	(u_char)0x10, (u_char)0x11, (u_char)0x12, (u_char)0x13,
	(u_char)0x14, (u_char)0x15, (u_char)0x16, (u_char)0x17,
	(u_char)0x18, (u_char)0x19, (u_char)0x1A, (u_char)0x1B,
	(u_char)0x1C, (u_char)0x1D, (u_char)0x1E, (u_char)0x1F,
	(u_char)0x20, (u_char)0x21, (u_char)0x22, (u_char)0x23,
	(u_char)0x24, (u_char)0x25, (u_char)0x26, (u_char)0x27,
	(u_char)0x28, (u_char)0x29, (u_char)0x2A, (u_char)0x2B,
	(u_char)0x2C, (u_char)0x2D, (u_char)0x2E, (u_char)0x2F,
	(u_char)0x30, (u_char)0x31, (u_char)0x32, (u_char)0x33,
	(u_char)0x34, (u_char)0x35, (u_char)0x36, (u_char)0x37,
	(u_char)0x38, (u_char)0x39, (u_char)0x3A, (u_char)0x3B,
	(u_char)0x3C, (u_char)0x3D, (u_char)0x3E, (u_char)0x3F,
	(u_char)0x40, (u_char)0x41, (u_char)0x42, (u_char)0x43,
	(u_char)0x44, (u_char)0x45, (u_char)0x46, (u_char)0x47,
	(u_char)0x48, (u_char)0x49, (u_char)0x4A, (u_char)0x4B,
	(u_char)0x4C, (u_char)0x4D, (u_char)0x4E, (u_char)0x4F,
	(u_char)0x50, (u_char)0x51, (u_char)0x52, (u_char)0x53,
	(u_char)0x54, (u_char)0x55, (u_char)0x56, (u_char)0x57,
	(u_char)0x58, (u_char)0x59, (u_char)0x5A, (u_char)0x5B,
	(u_char)0x5C, (u_char)0x5D, (u_char)0x5E, (u_char)0x5F,
	(u_char)0x60, (u_char)0x61, (u_char)0x62, (u_char)0x63,
	(u_char)0x64, (u_char)0x65, (u_char)0x66, (u_char)0x67,
	(u_char)0x68, (u_char)0x69, (u_char)0x6A, (u_char)0x6B,
	(u_char)0x6C, (u_char)0x6D, (u_char)0x6E, (u_char)0x6F,
	(u_char)0x70, (u_char)0x71, (u_char)0x72, (u_char)0x73,
	(u_char)0x74, (u_char)0x75, (u_char)0x76, (u_char)0x77,
	(u_char)0x78, (u_char)0x79, (u_char)0x7A, (u_char)0x7B,
	(u_char)0x7C, (u_char)0x7D, (u_char)0x7E, (u_char)0x7F,
	(u_char)0x80, (u_char)0x81, (u_char)0x82, (u_char)0x83,
	(u_char)0x84, (u_char)0x85, (u_char)0x86, (u_char)0x87,
	(u_char)0x88, (u_char)0x89, (u_char)0x8A, (u_char)0x8B,
	(u_char)0x8C, (u_char)0x8D, (u_char)0x8E, (u_char)0x8F,
	(u_char)0x90, (u_char)0x91, (u_char)0x92, (u_char)0x93,
	(u_char)0x94, (u_char)0x95, (u_char)0x96, (u_char)0x97,
	(u_char)0x98, (u_char)0x99, (u_char)0x9A, (u_char)0x9B,
	(u_char)0x9C, (u_char)0x9D, (u_char)0x9E, (u_char)0x9F,
	(u_char)0xA0, (u_char)0xA1, (u_char)0xA2, (u_char)0xA3,
	(u_char)0xA4, (u_char)0xA5, (u_char)0xA6, (u_char)0xA7,
	(u_char)0xB3, (u_char)0xA9, (u_char)0xAA, (u_char)0xAB,
	(u_char)0xAC, (u_char)0xAD, (u_char)0xAE, (u_char)0xAF,
	(u_char)0xB0, (u_char)0xB1, (u_char)0xB2, (u_char)0xB3,
	(u_char)0xB4, (u_char)0xB5, (u_char)0xB6, (u_char)0xB7,
	(u_char)0xA3, (u_char)0xB9, (u_char)0xBA, (u_char)0xBB,
	(u_char)0xBC, (u_char)0xBD, (u_char)0xBE, (u_char)0xBF,
	(u_char)0xE1, (u_char)0xE2, (u_char)0xF7, (u_char)0xE7,
	(u_char)0xE4, (u_char)0xE5, (u_char)0xF6, (u_char)0xFA,
	(u_char)0xE9, (u_char)0xEA, (u_char)0xEB, (u_char)0xEC,
	(u_char)0xED, (u_char)0xEE, (u_char)0xEF, (u_char)0xF0,
	(u_char)0xF2, (u_char)0xF3, (u_char)0xF4, (u_char)0xF5,
	(u_char)0xE6, (u_char)0xE8, (u_char)0xE3, (u_char)0xFE,
	(u_char)0xFB, (u_char)0xFD, (u_char)0xFF, (u_char)0xF9,
	(u_char)0xF8, (u_char)0xFC, (u_char)0xE0, (u_char)0xF1,
	(u_char)0xC1, (u_char)0xC2, (u_char)0xD7, (u_char)0xC7,
	(u_char)0xC4, (u_char)0xC5, (u_char)0xD6, (u_char)0xDA,
	(u_char)0xC9, (u_char)0xCA, (u_char)0xCB, (u_char)0xCC,
	(u_char)0xCD, (u_char)0xCE, (u_char)0xCF, (u_char)0xD0,
	(u_char)0xD2, (u_char)0xD3, (u_char)0xD4, (u_char)0xD5,
	(u_char)0xC6, (u_char)0xC8, (u_char)0xC3, (u_char)0xDE,
	(u_char)0xDB, (u_char)0xDD, (u_char)0xDF, (u_char)0xD9,
	(u_char)0xD8, (u_char)0xDC, (u_char)0xC0, (u_char)0xD1
};
 
/* koi8-win1251 recoding table */
static u_char koi82win[] = {
	(u_char)0x00, (u_char)0x01, (u_char)0x02, (u_char)0x03, 
	(u_char)0x04, (u_char)0x05, (u_char)0x06, (u_char)0x07, 
	(u_char)0x08, (u_char)0x09, (u_char)0x0A, (u_char)0x0B,
	(u_char)0x0C, (u_char)0x0D, (u_char)0x0E, (u_char)0x0F,
	(u_char)0x10, (u_char)0x11, (u_char)0x12, (u_char)0x13,
	(u_char)0x14, (u_char)0x15, (u_char)0x16, (u_char)0x17,
	(u_char)0x18, (u_char)0x19, (u_char)0x1A, (u_char)0x1B,
	(u_char)0x1C, (u_char)0x1D, (u_char)0x1E, (u_char)0x1F,
	(u_char)0x20, (u_char)0x21, (u_char)0x22, (u_char)0x23,
	(u_char)0x24, (u_char)0x25, (u_char)0x26, (u_char)0x27,
	(u_char)0x28, (u_char)0x29, (u_char)0x2A, (u_char)0x2B,
	(u_char)0x2C, (u_char)0x2D, (u_char)0x2E, (u_char)0x2F,
	(u_char)0x30, (u_char)0x31, (u_char)0x32, (u_char)0x33,
	(u_char)0x34, (u_char)0x35, (u_char)0x36, (u_char)0x37,
	(u_char)0x38, (u_char)0x39, (u_char)0x3A, (u_char)0x3B,
	(u_char)0x3C, (u_char)0x3D, (u_char)0x3E, (u_char)0x3F,
	(u_char)0x40, (u_char)0x41, (u_char)0x42, (u_char)0x43,
	(u_char)0x44, (u_char)0x45, (u_char)0x46, (u_char)0x47,
	(u_char)0x48, (u_char)0x49, (u_char)0x4A, (u_char)0x4B,
	(u_char)0x4C, (u_char)0x4D, (u_char)0x4E, (u_char)0x4F,
	(u_char)0x50, (u_char)0x51, (u_char)0x52, (u_char)0x53,
	(u_char)0x54, (u_char)0x55, (u_char)0x56, (u_char)0x57,
	(u_char)0x58, (u_char)0x59, (u_char)0x5A, (u_char)0x5B,
	(u_char)0x5C, (u_char)0x5D, (u_char)0x5E, (u_char)0x5F,
	(u_char)0x60, (u_char)0x61, (u_char)0x62, (u_char)0x63,
	(u_char)0x64, (u_char)0x65, (u_char)0x66, (u_char)0x67,
	(u_char)0x68, (u_char)0x69, (u_char)0x6A, (u_char)0x6B,
	(u_char)0x6C, (u_char)0x6D, (u_char)0x6E, (u_char)0x6F,
	(u_char)0x70, (u_char)0x71, (u_char)0x72, (u_char)0x73,
	(u_char)0x74, (u_char)0x75, (u_char)0x76, (u_char)0x77,
	(u_char)0x78, (u_char)0x79, (u_char)0x7A, (u_char)0x7B,
	(u_char)0x7C, (u_char)0x7D, (u_char)0x7E, (u_char)0x7F,
	(u_char)0x80, (u_char)0x81, (u_char)0x82, (u_char)0x83,
	(u_char)0x84, (u_char)0x85, (u_char)0x86, (u_char)0x87, 
	(u_char)0x88, (u_char)0x89, (u_char)0x8A, (u_char)0x8B,
	(u_char)0x8C, (u_char)0x8D, (u_char)0x8E, (u_char)0x8F,
	(u_char)0x90, (u_char)0x91, (u_char)0x92, (u_char)0x93,
	(u_char)0x94, (u_char)0x95, (u_char)0x96, (u_char)0x97,
	(u_char)0x98, (u_char)0x99, (u_char)0x9A, (u_char)0x9B,
	(u_char)0x9C, (u_char)0x9D, (u_char)0x9E, (u_char)0x9F,
	(u_char)0xA0, (u_char)0xA1, (u_char)0xA2, (u_char)0xB8,
	(u_char)0xA4, (u_char)0xA5, (u_char)0xA6, (u_char)0xA7,
	(u_char)0xA8, (u_char)0xA9, (u_char)0xAA, (u_char)0xAB,
	(u_char)0xAC, (u_char)0xAD, (u_char)0xAE, (u_char)0xAF,
	(u_char)0xB0, (u_char)0xB1, (u_char)0xB2, (u_char)0xA8,
	(u_char)0xB4, (u_char)0xB5, (u_char)0xB6, (u_char)0xB7,
	(u_char)0xB8, (u_char)0xB9, (u_char)0xBA, (u_char)0xBB,
	(u_char)0xBC, (u_char)0xBD, (u_char)0xBE, (u_char)0xBF,
	(u_char)0xFE, (u_char)0xE0, (u_char)0xE1, (u_char)0xF6,
	(u_char)0xE4, (u_char)0xE5, (u_char)0xF4, (u_char)0xE3,
	(u_char)0xF5, (u_char)0xE8, (u_char)0xE9, (u_char)0xEA,
	(u_char)0xEB, (u_char)0xEC, (u_char)0xED, (u_char)0xEE,
	(u_char)0xEF, (u_char)0xFF, (u_char)0xF0, (u_char)0xF1,
	(u_char)0xF2, (u_char)0xF3, (u_char)0xE6, (u_char)0xE2,
	(u_char)0xFC, (u_char)0xFB, (u_char)0xE7, (u_char)0xF8,
	(u_char)0xFD, (u_char)0xF9, (u_char)0xF7, (u_char)0xFA,
	(u_char)0xDE, (u_char)0xC0, (u_char)0xC1, (u_char)0xD6,
	(u_char)0xC4, (u_char)0xC5, (u_char)0xD4, (u_char)0xC3,
	(u_char)0xD5, (u_char)0xC8, (u_char)0xC9, (u_char)0xCA,
	(u_char)0xCB, (u_char)0xCC, (u_char)0xCD, (u_char)0xCE,
	(u_char)0xCF, (u_char)0xDF, (u_char)0xD0, (u_char)0xD1,
	(u_char)0xD2, (u_char)0xD3, (u_char)0xC6, (u_char)0xC2,
	(u_char)0xDC, (u_char)0xDB, (u_char)0xC7, (u_char)0xD8,
	(u_char)0xDD, (u_char)0xD9, (u_char)0xD7, (u_char)0xDA
};

static u_char *tables[] = {win2koi8, koi82win};

/* recodes string */
char *
recode(char *src, int offs)
{
	int i;
	u_char *table;

	table = tables[offs];

	i = 0;
	while (src[i] != '\0') {
		src[i] = table[(u_char)src[i]];
		++i;
	}
	
	return (src);
}
